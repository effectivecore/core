tests
- security__roles|Test
    id: security__roles
    title: Security of Roles
    description: The test will not succeed if the "Registration via EMail address" option is enabled!
    params
    - is_https|field_switcher
        title: HTTPS
        element_attributes
        - name: is_https
    scenario
  # ─────────────────────────────────────────────────────────────────────
  # anonymous user
  # ─────────────────────────────────────────────────────────────────────
    # url: /manage/data/content/text
    - request_url-/manage/data/content/text|step_request
        url: /manage/data/content/text
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text/test
    - request_url-/manage/data/content/text/test|step_request
        url: /manage/data/content/text/test
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text/test|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text//insert
    - request_url-/manage/data/content/text//insert|step_request
        url: /manage/data/content/text//insert
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text//insert|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text/test/update
    - request_url-/manage/data/content/text/test/update|step_request
        url: /manage/data/content/text/test/update
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text/test/update|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text/test/delete
    - request_url-/manage/data/content/text/test/delete|step_request
        url: /manage/data/content/text/test/delete
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text/test/delete|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
  # ─────────────────────────────────────────────────────────────────────
  # registered user
  # ─────────────────────────────────────────────────────────────────────
    # warming up the form for initialize CAPTCHA and Validation ID
    - form_registration_warming_up|step_request
        url: /registration
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - form_registration_submit|step_request
        url: /registration
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
        post
        - form_id: registration
        - validation_id: %%_test_form_validation_id{registration}
        - email: %%_test_email_random
        - nickname: %%_test_nickname_random{0}
        - password: %%_test_password_random
        - timezone: UTC
        - session_params[0]: is_remember
        - session_params[1]: is_fixed_ip
        - captcha: %%_test_captcha
        - button: register
    - response_check|step_check
        where: subm_errs
        match: 0
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text
    - request_url-/manage/data/content/text-registered|step_request
        url: /manage/data/content/text
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text/test
    - request_url-/manage/data/content/text/test-registered|step_request
        url: /manage/data/content/text/test
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text/test-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text//insert
    - request_url-/manage/data/content/text//insert-registered|step_request
        url: /manage/data/content/text//insert
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text//insert-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text/test/update
    - request_url-/manage/data/content/text/test/update-registered|step_request
        url: /manage/data/content/text/test/update
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text/test/update-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # url: /manage/data/content/text/test/delete
    - request_url-/manage/data/content/text/test/delete-registered|step_request
        url: /manage/data/content/text/test/delete
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-/manage/data/content/text/test/delete-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
  # ─────────────────────────────────────────────────────────────────────
  # registered user + role
  # ─────────────────────────────────────────────────────────────────────
    - set_roles|step_code
        handler: \effcore\modules\test\events_test::set_roles
        is_apply_tokens: true
        args
        - nickname: %%_test_nickname_random{0}
        - roles
          - =: test
        - is_reset: true
  # ─────────────────────────────────────────────────────────────────────
  # return
  # ─────────────────────────────────────────────────────────────────────
    - return_result|step_return
        value: 1